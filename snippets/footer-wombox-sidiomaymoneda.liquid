{%- comment -%}
  Pills de localizaci√≥n (pa√≠s/moneda + idioma)
  - Usa el form nativo: {% form 'localization' %} ‚Ä¶ {% endform %}
  - Sin JS: <details> para el desplegable y <button name="country_code"/"locale_code"> para enviar
  - Flags: por defecto muestra un emoji; si quieres iconos sube a assets "flag-xx.svg"
           y descomenta la l√≠nea indicada abajo.

  Props opcionales (al renderizar):
    - show_country: true/false (por defecto true si hay >1 pa√≠s)
    - show_language: true/false (por defecto true si hay >1 idioma)
{%- endcomment -%}

{%- assign _show_country   = show_country | default: (localization.available_countries.size > 1) -%}
{%- assign _show_language  = show_language | default: (localization.available_languages.size > 1) -%}

<div class="locpill-wrap" role="group" aria-label="Selecci√≥n de pa√≠s e idioma">
  {%- if _show_country -%}
    {% form 'localization', id: 'LocPillCountry', class: 'locpill' %}
      <details class="locpill__details">
        <summary class="locpill__summary" aria-label="Cambiar pa√≠s y moneda">
          <span class="locpill__flag">
            {%- assign cc = localization.country.iso_code | downcase -%}
            {#-- Si subes banderas a assets como flag-es.svg, descomenta:
            <img src="{{ ('flag-' | append: cc | append: '.svg') | asset_url }}" alt="{{ localization.country.name }}" />
            --#}
            <span class="locpill__emoji">{{ localization.country.iso_code | replace: 'ES', 'üá™üá∏' | replace: 'US', 'üá∫üá∏' }}</span>
          </span>
          <span class="locpill__label">
            {{ localization.country.name | upcase }} {{ localization.country.currency.symbol }}
          </span>
          <span class="locpill__chev" aria-hidden="true">‚ñæ</span>
        </summary>

        <div class="locpill__list" role="listbox">
          {%- for country in localization.available_countries -%}
            <button type="submit"
                    name="country_code"
                    value="{{ country.iso_code }}"
                    class="locpill__option"
                    aria-current="{{ country.iso_code == localization.country.iso_code }}">
              <span class="locpill__opt-flag">
                {%- assign cc2 = country.iso_code | downcase -%}
                {#-- Para banderas en assets:
                <!--<img src="{{ ('flag-' | append: cc2 | append: '.svg') | asset_url }}" alt="" />-->
                --#}
                <span class="locpill__emoji">
                  {{ country.iso_code | replace: 'ES', 'üá™üá∏' | replace: 'US', 'üá∫üá∏' }}
                </span>
              </span>
              <span class="locpill__opt-label">{{ country.name }} {{ country.currency.symbol }}</span>
            </button>
          {%- endfor -%}
        </div>
      </details>
    {% endform %}
  {%- endif -%}

  {%- if _show_language -%}
    {% form 'localization', id: 'LocPillLanguage', class: 'locpill' %}
      <details class="locpill__details">
        <summary class="locpill__summary" aria-label="Cambiar idioma">
          <span class="locpill__flag">
            <span class="locpill__emoji">üåê</span>
          </span>
          <span class="locpill__label">
            {{ localization.language.endonym_name | default: localization.language.name | upcase }}
          </span>
          <span class="locpill__chev" aria-hidden="true">‚ñæ</span>
        </summary>

        <div class="locpill__list" role="listbox">
          {%- for language in localization.available_languages -%}
            <button type="submit"
                    name="locale_code"
                    value="{{ language.iso_code }}"
                    class="locpill__option"
                    aria-current="{{ language.iso_code == localization.language.iso_code }}">
              <span class="locpill__opt-label">
                {{ language.endonym_name | default: language.name }}
              </span>
            </button>
          {%- endfor -%}
        </div>
      </details>
    {% endform %}
  {%- endif -%}
</div>
<style>
/* ===== Pills de localizaci√≥n (pa√≠s/idioma) ===== */
.locpill-wrap{display:flex;gap:28px;align-items:center;flex-wrap:wrap}

.locpill{position:relative}
.locpill__details{display:block}
.locpill__summary{
  display:flex;align-items:center;gap:14px;
  padding:14px 22px;border:2px solid #fff;border-radius:999px;
  color:#fff;background:transparent;cursor:pointer;list-style:none;
}
.locpill__summary::-webkit-details-marker{display:none}
.locpill__flag{width:34px;height:34px;border-radius:50%;display:grid;place-items:center;overflow:hidden;background:rgba(255,255,255,.15)}
.locpill__flag img{width:100%;height:100%;object-fit:cover;display:block}
.locpill__emoji{font-size:20px;line-height:1}
.locpill__label{font-family:'Archivo',Inter,system-ui,Arial,sans-serif;font-size:24px;font-weight:700;letter-spacing:.5px}
.locpill__chev{margin-left:6px;font-size:18px;opacity:.9}

/* Panel opciones */
.locpill__list{
  position:absolute;left:0;right:auto;z-index:10;min-width:100%;
  margin-top:8px;padding:8px;background:rgba(0,0,0,.25);
  backdrop-filter:saturate(150%) blur(6px);
  border:1px solid rgba(255,255,255,.3);border-radius:14px;
  display:none;
}
.locpill__details[open] .locpill__list{display:block}

.locpill__option{
  display:flex;align-items:center;gap:10px;width:100%;
  padding:10px 12px;background:transparent;border:0;color:#fff;text-align:left;border-radius:10px;
}
.locpill__option:hover,.locpill__option[aria-current="true"]{background:rgba(255,255,255,.15)}

.locpill__opt-flag{width:22px;display:grid;place-items:center}
.locpill__opt-flag img{width:100%;height:auto;display:block}
.locpill__opt-label{font-size:15px}

/* Responsive */
@media (max-width: 768px){
  .locpill-wrap{gap:14px}
  .locpill__summary{padding:12px 18px}
  .locpill__label{font-size:18px}
  .locpill__flag{width:28px;height:28px}
}

</style>