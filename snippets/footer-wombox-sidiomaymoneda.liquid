{%- comment -%}
  Pills Pa√≠s/Moneda + Idioma (sin JS del tema)
  Par√°metros opcionales al render:
    - show_country: true/false (si no se pasa, se activa cuando hay >1 pa√≠s)
    - show_language: true/false (si no se pasa, se activa cuando hay >1 idioma)
{%- endcomment -%}

{% liquid
  assign _show_country  = show_country
  assign _show_language = show_language

%}

{% assign _show_country = false %}
{% if localization.available_countries.size > 1 %}
  {% assign _show_country = true %}
{% endif %}

{% assign _show_language = false %}
{% if localization.available_languages.size > 1 %}
  {% assign _show_language = true %}
{% endif %}

<div class="locpill-wrap" role="group" aria-label="Selecci√≥n de pa√≠s e idioma">
  {%- if _show_country -%}
    {% form 'localization', id: 'LocPillCountry', class: 'locpill locpill--xxs' %}
      <details class="locpill__details">
        <summary class="locpill__summary" aria-label="Cambiar pa√≠s y moneda">
          <span class="locpill__flag">



            {% assign cc = localization.country.iso_code | upcase %}
                  <span class="locpill__flag">
                    {% if cc == 'ES' %}
                      <img class="locpill__flag-img"
                          src="https://cdn.shopify.com/s/files/1/0908/5973/3339/files/7a50cfa9897df6c2e5e814f4f02ab01d00a9323d.png?v=1757594960"
                          alt="Bandera de Espa√±a" loading="lazy" decoding="async">
                    {% else %}
                      <span class="locpill__emoji" data-cc="{{ cc }}"></span>
                    {% endif %}
                  </span>



          </span>
          <span class="locpill__label">{{ localization.country.name | upcase }} {{ localization.country.currency.symbol }}</span>
          <span class="locpill__chev" aria-hidden="true">‚ñæ</span>
        </summary>

        
        <div class="locpill__modal" aria-modal="true" role="dialog">
          <button class="locpill__overlay" type="button" data-close aria-label="Cerrar"></button>

          <div class="locpill__panel" role="document">
            <div class="locpill__head">
              <span class="locpill__title">Selecciona pa√≠s y moneda</span>
              <button class="locpill__close" type="button" data-close aria-label="Cerrar">‚úï</button>
            </div>

            <div class="locpill__options" role="listbox">
              {%- for country in localization.available_countries -%}
                <button type="submit"
                        name="country_code"
                        value="{{ country.iso_code }}"
                        class="locpill__option"
                        {% if country.iso_code == localization.country.iso_code %}aria-current="true"{% endif %}>
                  <span class="locpill__opt-flag">
                    <span class="locpill__emoji">{{ country.iso_code | upcase }}</span>
                  </span>
                  <span class="locpill__opt-label">{{ country.name }} {{ country.currency.symbol }}</span>
                </button>
              {%- endfor -%}
            </div>
          </div>
        </div>
      </details>
    {% endform %}
  {%- endif -%}

  {%- if _show_language -%}
    {% form 'localization', id: 'LocPillLanguage', class: 'locpill locpill--xxs' %}
      <details class="locpill__details">
<summary class="locpill__summary" aria-label="Cambiar idioma">



 {% assign cc = localization.country.iso_code | downcase %}

<span class="locpill__flag">
  {% case cc %}
    {% when 'es' %} {# Espa√±a #}
      <img class="locpill__flag-img" src="URL_ES" alt="Bandera de Espa√±a" loading="lazy" decoding="async">

    {% when 'de' %} {# Alemania #}
      <img class="locpill__flag-img" src="URL_DE" alt="Bandera de Alemania" loading="lazy" decoding="async">

    {% when 'be' %} {# B√©lgica #}
      <img class="locpill__flag-img" src="URL_BE" alt="Bandera de B√©lgica" loading="lazy" decoding="async">

    {% when 'cz' %} {# Chequia #}
      <img class="locpill__flag-img" src="URL_CZ" alt="Bandera de Chequia" loading="lazy" decoding="async">

    {% when 'hr' %} {# Croacia #}
      <img class="locpill__flag-img" src="URL_HR" alt="Bandera de Croacia" loading="lazy" decoding="async">

    {% when 'sk' %} {# Eslovaquia #}
      <img class="locpill__flag-img" src="URL_SK" alt="Bandera de Eslovaquia" loading="lazy" decoding="async">

    {% when 'fi' %} {# Finlandia #}
      <img class="locpill__flag-img" src="URL_FI" alt="Bandera de Finlandia" loading="lazy" decoding="async">

    {% when 'gr' %} {# Grecia #}
      <img class="locpill__flag-img" src="URL_GR" alt="Bandera de Grecia" loading="lazy" decoding="async">

    {% when 'ie' %} {# Irlanda #}
      <img class="locpill__flag-img" src="URL_IE" alt="Bandera de Irlanda" loading="lazy" decoding="async">

    {% when 'lt' %} {# Lituania #}
      <img class="locpill__flag-img" src="URL_LT" alt="Bandera de Lituania" loading="lazy" decoding="async">

    {% when 'mt' %} {# Malta #}
      <img class="locpill__flag-img" src="URL_MT" alt="Bandera de Malta" loading="lazy" decoding="async">

    {% when 'pl' %} {# Polonia #}
      <img class="locpill__flag-img" src="URL_PL" alt="Bandera de Polonia" loading="lazy" decoding="async">

    {% when 'gb' %} {# Reino Unido #}
      <img class="locpill__flag-img" src="URL_GB" alt="Bandera del Reino Unido" loading="lazy" decoding="async">

    {% when 'ch' %} {# Suiza #}
      <img class="locpill__flag-img" src="URL_CH" alt="Bandera de Suiza" loading="lazy" decoding="async">

    {% when 'at' %} {# Austria #}
      <img class="locpill__flag-img" src="URL_AT" alt="Bandera de Austria" loading="lazy" decoding="async">

    {% when 'bg' %} {# Bulgaria #}
      <img class="locpill__flag-img" src="URL_BG" alt="Bandera de Bulgaria" loading="lazy" decoding="async">

    {% when 'va' %} {# Ciudad del Vaticano #}
      <img class="locpill__flag-img" src="URL_VA" alt="Bandera de Ciudad del Vaticano" loading="lazy" decoding="async">

    {% when 'dk' %} {# Dinamarca #}
      <img class="locpill__flag-img" src="URL_DK" alt="Bandera de Dinamarca" loading="lazy" decoding="async">

    {% when 'si' %} {# Eslovenia #}
      <img class="locpill__flag-img" src="URL_SI" alt="Bandera de Eslovenia" loading="lazy" decoding="async">

    {% when 'ee' %} {# Estonia #}
      <img class="locpill__flag-img" src="URL_EE" alt="Bandera de Estonia" loading="lazy" decoding="async">

    {% when 'fr' %} {# Francia #}
      <img class="locpill__flag-img" src="URL_FR" alt="Bandera de Francia" loading="lazy" decoding="async">

    {% when 'hu' %} {# Hungr√≠a #}
      <img class="locpill__flag-img" src="URL_HU" alt="Bandera de Hungr√≠a" loading="lazy" decoding="async">

    {% when 'it' %} {# Italia #}
      <img class="locpill__flag-img" src="URL_IT" alt="Bandera de Italia" loading="lazy" decoding="async">

    {% when 'lu' %} {# Luxemburgo #}
      <img class="locpill__flag-img" src="URL_LU" alt="Bandera de Luxemburgo" loading="lazy" decoding="async">

    {% when 'nl' %} {# Pa√≠ses Bajos #}
      <img class="locpill__flag-img" src="URL_NL" alt="Bandera de Pa√≠ses Bajos" loading="lazy" decoding="async">

    {% when 'pt' %} {# Portugal #}
      <img class="locpill__flag-img" src="URL_PT" alt="Bandera de Portugal" loading="lazy" decoding="async">

    {% when 'ro' %} {# Ruman√≠a #}
      <img class="locpill__flag-img" src="URL_RO" alt="Bandera de Ruman√≠a" loading="lazy" decoding="async">

    {% else %}
      <span class="locpill__emoji">üåê</span>
  {% endcase %}
</span>




  <!-- Texto con bandera inline cuando ES -->
  <span class="locpill__label">
    {{ localization.language.endonym_name | default: localization.language.name | upcase }}
  </span>

  <span class="locpill__chev" aria-hidden="true">‚ñæ</span>
</summary>

        <div class="locpill__modal" aria-modal="true" role="dialog">
          <button class="locpill__overlay" type="button" data-close aria-label="Cerrar"></button>

          <div class="locpill__panel" role="document">
            <div class="locpill__head">
              <span class="locpill__title">Selecciona idioma</span>
              <button class="locpill__close" type="button" data-close aria-label="Cerrar">‚úï</button>
            </div>

            <div class="locpill__options" role="listbox">
              {%- for language in localization.available_languages -%}
                <button type="submit"
                        name="locale_code"
                        value="{{ language.iso_code }}"
                        class="locpill__option"
                        {% if language.iso_code == localization.language.iso_code %}aria-current="true"{% endif %}>
                  <span class="locpill__opt-label">{{ language.endonym_name | default: language.name }}</span>
                </button>
              {%- endfor -%}
            </div>
          </div>
        </div>
      </details>
    {% endform %}
  {%- endif -%}
</div>

<style>
/* ===== P√çLDORAS EN LA MISMA L√çNEA ===== */
.locpill-wrap{
  display:inline-flex;
  align-items:center;
  gap:10px;
  flex-wrap:nowrap;
  white-space:nowrap;
}
form.locpill{ display:inline-flex; width:auto !important; flex:0 0 auto; margin:0; }
.locpill__details{ display:inline-block; }
.locpill__summary{ display:inline-flex; width:auto; margin:0; white-space:nowrap; }

/* ===== Tama√±os ===== */
.locpill--sm{
  --pill-h:26px; --pill-px:12px; --pill-gap:8px; --flag-size:20px; --border-w:1.6px;
}
.locpill--xxs{
  --pill-h:18px; --pill-px:8px; --pill-gap:6px; --flag-size:14px; --border-w:1.2px;
}
.locpill--micro{
  --pill-h:16px; --pill-px:6px; --pill-gap:4px; --flag-size:12px; --border-w:1px;
}

/* ===== Base pill ===== */
.locpill{ position:relative; }
.locpill__summary{
  list-style:none;
  align-items:center; gap:var(--pill-gap);
  height:var(--pill-h); padding:0 var(--pill-px);
  border-radius:9999px; border:var(--border-w) solid #fff;
  background:rgba(255,255,255,.08);
  color:#fff; font-weight:600; text-transform:uppercase;
  font-size:10px; line-height:1; cursor:pointer; -webkit-tap-highlight-color:transparent;
}
.locpill--sm .locpill__summary{ font-size:12px; }
.locpill--xxs .locpill__summary{ font-size:10px; }
.locpill--micro .locpill__summary{ font-size:9px; }
.locpill__summary::-webkit-details-marker{ display:none; }

.locpill__flag{ width:var(--flag-size); height:var(--flag-size); border-radius:9999px; overflow:hidden; display:grid; place-items:center; flex:0 0 var(--flag-size); }
.locpill__emoji{ font-size:11px; line-height:1; }
.locpill--sm .locpill__emoji{ font-size:14px; }

.locpill__label{ white-space:nowrap; }
.locpill__chev{ margin-left:auto; font-size:9px; transition:transform .2s; }
.locpill__details[open] .locpill__chev{ transform:rotate(180deg); }

/* ===== MODAL CENTRADO ===== */
.locpill__modal{ position:fixed; inset:0; display:none; z-index:999; }
.locpill__details[open] .locpill__modal{ display:flex; }

.locpill__overlay{ position:absolute; inset:0; background:rgba(0,0,0,.55); border:0; cursor:pointer; }
.locpill__panel{
  position:relative; margin:auto; width:min(560px,92vw); max-height:80vh; overflow:auto;
  background:#fff; color:#111; border-radius:16px; padding:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.25);
}
.locpill__head{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px; }
.locpill__title{ font-weight:700; font-size:16px; }
.locpill__close{ background:transparent; border:0; font-size:20px; line-height:1; cursor:pointer; padding:6px; border-radius:8px; }
.locpill__close:hover{ background:#f3f3f3; }

/* Grid de opciones del modal */
.locpill__options{
  display:grid; grid-template-columns:repeat(auto-fill, minmax(180px,1fr));
  gap:8px; padding:4px;
}

/* Estilo de opci√≥n (modo modal) */
.locpill__option{
  width:100%; display:flex; align-items:center; gap:8px;
  padding:10px 12px; border-radius:10px;
  background:#f7f7f7; border:none; cursor:pointer; text-align:left; font-size:13px;
}
.locpill__option:hover{ background:#efefef; }
.locpill__option[aria-current="true"]{ background:#e8e8e8; font-weight:600; }

/* Accesibilidad */
.locpill__summary:focus-visible, .locpill__option:focus-visible{ outline:2px solid #fff; outline-offset:2px; }
html.locpill--modal-open, body.locpill--modal-open{ overflow:hidden; }

/* Opcional: scroll horizontal si el viewport es MUY estrecho */
@media (max-width: 380px){
  .locpill-wrap{ overflow-x:auto; -webkit-overflow-scrolling:touch; }
}
</style>

<script>
/* ===== Comportamiento del modal (ligero y sin dependencias) ===== */
(function(){
  // Cerrar al pulsar overlay o la X
  document.addEventListener('click', function(ev){
    if(ev.target.matches('.locpill__overlay, .locpill__close')){
      const d = ev.target.closest('.locpill__details'); if(d) d.removeAttribute('open');
    }
  });

  // Cerrar con ESC
  document.addEventListener('keydown', function(ev){
    if(ev.key === 'Escape'){
      document.querySelectorAll('.locpill__details[open]').forEach(d=>d.removeAttribute('open'));
    }
  });

  // Bloquear/desbloquear scroll de la p√°gina seg√∫n estado del modal
  document.addEventListener('toggle', function(ev){
    if(ev.target.classList && ev.target.classList.contains('locpill__details')){
      const anyOpen = document.querySelector('.locpill__details[open]');
      document.documentElement.classList.toggle('locpill--modal-open', !!anyOpen);
      document.body.classList.toggle('locpill--modal-open', !!anyOpen);
    }
  }, true);
})();
</script>
