{%- doc -%}
  Renders a sticky product bar that appears when the main buy button is not visible.
  Contains product title, price, variant picker (if applicable), and add to cart button.

  @param {object} product - The product object
  @param {string} section_id - The section ID
{%- enddoc -%}

{% liquid
  assign product_form_id = 'StickyProductBar-ProductForm-' | append: product.id | append: '-' | append: section_id
  
  if product.selected_or_first_available_variant.available
    assign can_add_to_cart = true
    assign add_to_cart_text = 'actions.add_to_cart' | t
  else
    assign can_add_to_cart = false
    assign add_to_cart_text = 'products.product.sold_out' | t
  endif
%}


<sticky-product-bar-component
  class="sticky-product-bar"
  data-product-id="{{ product.id }}"
  data-section-id="{{ section_id }}"
  hidden
>
  <div class="sticky-product-bar__container page-width section section--full-width-margin">
    <div class="sticky-product-bar__content">
      <!-- Product Info -->
      <div class="sticky-product-bar__product-info">
        <h3 class="sticky-product-bar__title">{{ product.title }}</h3>
        <div class="sticky-product-bar__price">
          {% render 'price', product_resource: product %}
        </div>
      </div>

      <!-- Variant Picker (if applicable) -->
      {% if product.variants.size > 1 %}
        <div class="sticky-product-bar__variant-picker">
          {% render 'variant-main-picker', product_resource: product %}
        </div>
      {% endif %}

      <!-- Add to Cart Form -->
      <div class="sticky-product-bar__form">
        <product-form-component
          data-section-id="{{ section_id }}"
          data-product-id="{{ product.id }}"
          data-product-url="{{ product.url }}"
          on:submit="/handleSubmit"
          data-quantity-default="{% if product.selected_or_first_available_variant.quantity_rule.min %}{{ product.selected_or_first_available_variant.quantity_rule.min }}{% else %}1{% endif %}"
        >
          <div
            class="visually-hidden"
            aria-live="assertive"
            role="status"
            aria-atomic="true"
            ref="liveRegion"
          ></div>
          {%- form 'product', product, id: product_form_id, novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
            <input
              type="hidden"
              name="id"
              ref="variantId"
              value="{{ product.selected_or_first_available_variant.id }}"
            >
            <input
              type="hidden"
              name="quantity"
              value="{% if product.selected_or_first_available_variant.quantity_rule.min %}{{ product.selected_or_first_available_variant.quantity_rule.min }}{% else %}1{% endif %}"
            >
            
            {% render 'add-to-cart-button',
              add_to_cart_text: add_to_cart_text,
              class: 'button sticky-product-bar__button',
              can_add_to_cart: can_add_to_cart,
              product: product
            %}
          {%- endform -%}
        </product-form-component>
      </div>
    </div>
  </div>
</sticky-product-bar-component>

{% stylesheet %}
  .sticky-product-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: var(--layer-sticky);
    background-color: var(--color-background);
    border-top: 1px solid var(--color-border);
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    transform: translateY(100%);
    transition: transform var(--animation-speed) var(--animation-easing);
  }

  .sticky-product-bar[data-visible="true"] {
    transform: translateY(0);
  }

  .sticky-product-bar__container {
    padding-block: var(--padding-md);
  }

  .sticky-product-bar__content {
    display: flex;
    align-items: center;
    gap: var(--gap-md);
    flex-wrap: wrap;
  }

  .sticky-product-bar__product-info {
    flex: 1;
    min-width: 200px;
  }

  .sticky-product-bar__title {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    margin: 0;
    line-height: 1.2;
    color: var(--color-text);
  }

  .sticky-product-bar__price {
    margin-top: var(--padding-xs);
  }

  .sticky-product-bar__variant-picker {
    flex-shrink: 0;
  }

  .sticky-product-bar__form {
    flex-shrink: 0;
  }

  .sticky-product-bar__button {
    min-width: 140px;
    white-space: nowrap;
  }
  .sticky-product-bar .add-to-cart-icon {
    display: none;
  }
  @media screen and (max-width: 749px) {
    .sticky-product-bar__content {
      gap: var(--gap-sm);
    }

    .sticky-product-bar__product-info {
      min-width: 150px;
    }

    .sticky-product-bar__title {
      font-size: var(--font-size-xs);
    }

    .sticky-product-bar__button {
      min-width: 120px;
      padding-inline: var(--padding-md);
      padding-block: var(--padding-sm);
    }
  }
{% endstylesheet %} 