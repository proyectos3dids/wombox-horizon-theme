{{ 'footer-wombox.css' | asset_url | stylesheet_tag }}

<!-- Normalizador de iconos de redes (puedes moverlo a footer-wombox.css) -->
<style>
  .wbf__social, .wbfm__social { --social-size: 20px; gap:16px; }
  .wbf__soc-a { display:inline-flex; align-items:center; justify-content:center; }
  .wbf__soc-img { height: var(--social-size); width:auto; display:block; }
  .wbf__soc-svg { line-height:0; display:inline-flex; }
  .wbf__soc-svg svg { height: var(--social-size); width:auto; display:block; }
</style>

<!-- sections/footer-wombox.liquid -->
<footer class="wombox-footer">
  <!-- DESKTOP -->
  <div class="wbf__inner">
    <div class="wbf__menus">
      {% for block in section.blocks %}
        {% if block.type == 'menu_column' %}
          <nav class="wbf__col" {{ block.shopify_attributes }}>
            {% if block.settings.menu != blank %}
              <ul class="wbf__list">
                {% for link in block.settings.menu.links %}
                  <li class="wbf__item"><a class="wbf__link" href="{{ link.url }}">{{ link.title }}</a></li>
                {% endfor %}
              </ul>
            {% endif %}
          </nav>
        {% endif %}
      {% endfor %}
    </div>

    <div class="wbf__cta-col">
      <a href="{{ section.settings.cta_link }}" class="wbf__cta">{{ section.settings.cta_text }}</a>

      <!-- Redes sociales DESKTOP (editables) -->
      <div class="wbf__social" aria-label="Redes sociales">
        {% assign has_social = false %}
        {% for block in section.blocks %}
          {% if block.type == 'social_link' %}
            {% assign has_social = true %}
            <a href="{{ block.settings.url | default: '#' }}"
               {% if block.settings.new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
               class="wbf__soc-a" {{ block.shopify_attributes }}>
              {% if block.settings.icon_svg != blank %}
                <span class="wbf__soc-svg">{{ block.settings.icon_svg }}</span>
              {% elsif block.settings.icon_image != blank %}
                <img class="wbf__soc-img"
                     src="{{ block.settings.icon_image | image_url }}"
                     alt="{{ block.settings.alt | escape }}"
                     loading="lazy">
              {% endif %}
            </a>
          {% endif %}
        {% endfor %}
        {% unless has_social %}
          <!-- Fallback si no hay bloques configurados -->
          <a href="#" class="wbf__soc-a">f</a><a href="#" class="wbf__soc-a">i</a>
          <a href="#" class="wbf__soc-a">x</a><a href="#" class="wbf__soc-a">in</a>
          <a href="#" class="wbf__soc-a">▶</a><a href="#" class="wbf__soc-a">t</a>
        {% endunless %}
      </div>
    </div>
  </div>

  <!-- MÓVIL: acordeones + redes -->
  <div class="wbf__inner--mobile" aria-label="Footer móvil">
    {% for block in section.blocks %}
      {% if block.type == 'menu_column' and block.settings.menu != blank %}
        <details class="wbfm__acc" {{ block.shopify_attributes }}>
          <summary class="wbfm__sum">
           {% assign accordion_title = block.settings.mobile_title | default: block.settings.menu.title %}
         <span class="wbfm__title">{{ accordion_title | upcase }}</span>
            <span class="wbfm__icon" aria-hidden="true">+</span>
          </summary>
          <ul class="wbfm__list">
            {% for link in block.settings.menu.links %}
              <li class="wbfm__item"><a class="wbfm__link" href="{{ link.url }}">{{ link.title }}</a></li>
            {% endfor %}
          </ul>
        </details>
      {% endif %}
    {% endfor %}

    <!-- Redes sociales MÓVIL (editables) -->
    <div class="wbfm__social" aria-label="Redes sociales">
      {% assign has_social_m = false %}
      {% for block in section.blocks %}
        {% if block.type == 'social_link' %}
          {% assign has_social_m = true %}
          <a href="{{ block.settings.url | default: '#' }}"
             {% if block.settings.new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
             class="wbf__soc-a" {{ block.shopify_attributes }}>
            {% if block.settings.icon_svg != blank %}
              <span class="wbf__soc-svg">{{ block.settings.icon_svg }}</span>
            {% elsif block.settings.icon_image != blank %}
              <img class="wbf__soc-img"
                   src="{{ block.settings.icon_image | image_url }}"
                   alt="{{ block.settings.alt | escape }}"
                   loading="lazy">
            {% endif %}
          </a>
        {% endif %}
      {% endfor %}
      {% unless has_social_m %}
        <a href="#" class="wbf__soc-a">f</a><a href="#" class="wbf__soc-a">i</a>
        <a href="#" class="wbf__soc-a">x</a><a href="#" class="wbf__soc-a">in</a>
        <a href="#" class="wbf__soc-a">▶</a><a href="#" class="wbf__soc-a">t</a>
      {% endunless %}
    </div>
  </div>

  {% if section.settings.strip_image != blank %}
    {% assign strip_src = section.settings.strip_image | image_url %}
    <div class="wbf__bottom" style="--pay-size: {{ section.settings.payments_size }}px;">

      <!-- Pagos DESKTOP (en franja) -->
      <div class="wbf__payments" aria-label="Métodos de pago">
        {% if section.settings.use_custom_payment_icons %}
          {% for block in section.blocks %}
            {% if block.type == 'payment_icon' and block.settings.icon_image != blank %}
              <span class="wbf__pay-pill" {{ block.shopify_attributes }}>
                <img src="{{ block.settings.icon_image | image_url }}" alt="{{ block.settings.icon_alt | escape }}" loading="lazy">
              </span>
            {% endif %}
          {% endfor %}
        {% elsif section.settings.show_payments %}
          {% for type in shop.enabled_payment_types %}
            <span class="wbf__pay-pill">{{ type | payment_type_svg_tag }}</span>
          {% endfor %}
        {% endif %}
      </div>

      <!-- Slider WOMBOX -->
      <div class="wbf__marquee"
           style="--marquee-h: {{ section.settings.strip_height }}px; --marquee-speed: {{ section.settings.strip_speed }}s; --marquee-gap: {{ section.settings.strip_gap }}px;">
        <div class="wbf__track">
          {% for i in (1..8) %}<img src="{{ strip_src }}" alt="WOMBOX" class="wbf__item-img">{% endfor %}
          {% for i in (1..8) %}<img src="{{ strip_src }}" alt="WOMBOX" class="wbf__item-img">{% endfor %}
        </div>
      </div>

      <!-- Copy desktop -->
      <p class="wbf__copy wbf__copy--desktop">© {{ 'now' | date: "%Y" }} WOMBOX</p>
    </div>
  {% endif %}

  <!-- Pagos MÓVIL (fuera de franja) -->
  <div class="wbf__payments-mobile" style="--pay-size: {{ section.settings.payments_size }}px;" aria-label="Métodos de pago">
    {% if section.settings.use_custom_payment_icons %}
      {% for block in section.blocks %}
        {% if block.type == 'payment_icon' and block.settings.icon_image != blank %}
          <span class="wbf__pay-pill" {{ block.shopify_attributes }}>
            <img src="{{ block.settings.icon_image | image_url }}" alt="{{ block.settings.icon_alt | escape }}" loading="lazy">
          </span>
        {% endif %}
      {% endfor %}
    {% elsif section.settings.show_payments %}
      {% for type in shop.enabled_payment_types %}
        <span class="wbf__pay-pill">{{ type | payment_type_svg_tag }}</span>
      {% endfor %}
    {% endif %}
  </div>

  <!-- Copy móvil -->
  <p class="wbf__copy wbf__copy--mobile">© {{ 'now' | date: "%Y" }} WOMBOX</p>
</footer>

{% schema %}
{
  "name": "Footer WOMBOX (Desktop)",
  "tag": "section",
  "class": "section-footer-wombox",
  "settings": [
    { "type": "text", "id": "cta_text", "label": "Texto del botón CTA", "default": "DESCUBRE NUESTRAS CAJAS" },
    { "type": "url", "id": "cta_link", "label": "Enlace del botón CTA" },

    { "type": "image_picker", "id": "strip_image", "label": "Imagen de franja (slider)" },
    { "type": "range", "id": "strip_height", "label": "Altura de la franja", "min": 60, "max": 220, "step": 2, "default": 120, "unit": "px" },
    { "type": "range", "id": "strip_speed", "label": "Velocidad del slider", "min": 5, "max": 60, "step": 1, "default": 25, "unit": "s" },
    { "type": "range", "id": "strip_gap", "label": "Separación entre imágenes", "min": 0, "max": 300, "step": 5, "default": 140, "unit": "px" },

    { "type": "checkbox", "id": "show_payments", "label": "Mostrar métodos de pago automáticos", "default": false },
    { "type": "checkbox", "id": "use_custom_payment_icons", "label": "Usar iconos de pago (subidos en bloques)", "default": true },
    { "type": "range", "id": "payments_size", "label": "Tamaño de iconos de pago", "min": 14, "max": 26, "step": 1, "default": 18, "unit": "px" }
  ],
  "blocks": [
    {
      "type": "menu_column",
      "name": "Columna de menú",
      "limit": 3,
      "settings": [
        { "type": "link_list", "id": "menu", "label": "Selecciona un menú" },
        {
          "type": "text",
          "id": "mobile_title",
          "label": "Título móvil del acordeón",
          "info": "Si lo dejas vacío, se usa el nombre del menú."
        }
      ]
    },
    {
      "type": "payment_icon",
      "name": "Icono de pago (imagen)",
      "limit": 10,
      "settings": [
        { "type": "image_picker", "id": "icon_image", "label": "Subir icono de pago (SVG/PNG)" },
        { "type": "text", "id": "icon_alt", "label": "Texto alternativo" }
      ]
    },
    {
      "type": "social_link",
      "name": "Red social (icono)",
      "limit": 12,
      "settings": [
        { "type": "image_picker", "id": "icon_image", "label": "Icono como imagen (SVG/PNG/JPG)" },
        { "type": "textarea", "id": "icon_svg", "label": "Icono como SVG (pega el código <svg>…</svg>)", "info": "Si rellenas este campo, se usará el SVG en lugar de la imagen." },
        { "type": "text", "id": "alt", "label": "Texto alternativo", "default": "Red social" },
        { "type": "url", "id": "url", "label": "Enlace" },
        { "type": "checkbox", "id": "new_tab", "label": "Abrir en nueva pestaña", "default": true }
      ]
    }
  ],
  "max_blocks": 40,
  "presets": [
    {
      "name": "Footer WOMBOX (Desktop)",
      "blocks": [
        { "type": "menu_column" },
        { "type": "menu_column" },
        { "type": "menu_column" }
      ]
    }
  ]
}
{% endschema %}
