{% comment %}
  Bloque personalizado para selector de cajas
  Implementación completa del sistema de cajas con metaobjects
{% endcomment %}

{%- assign listado_cajas = shop.metaobjects.listado_cajas['listado-cajas'].lista -%}
{%- assign cajas = listado_cajas.value -%}

{%- if cajas -%}
  {{ 'cajas-styles.css' | asset_url | stylesheet_tag }}
  <script src="{{ 'cajas-selector.js' | asset_url }}" defer></script>
  
  <div class="product-info__block product-info__cajas" {{ block.shopify_attributes }}>
    <cajas-selector class="cajas-selector">
      <h4 class="cajas-title">{{ block.settings.title | default: 'Selecciona tu caja' }}</h4>
      {%- if block.settings.description != blank -%}
        <p class="cajas-description">{{ block.settings.description }}</p>
      {%- endif -%}
      <div class="cajas-options">
        {%- for caja in cajas -%}
          <div class="cajas-option" data-caja-handle="{{ caja.system.handle }}">
            <input type="radio" name="caja-selection" id="caja-{{ caja.system.handle }}" value="{{ caja.system.handle }}" class="cajas-option-input">
            <label for="caja-{{ caja.system.handle }}" class="cajas-option-label">
              {%- assign imagen_field = caja.imagen -%}
              {%- assign titulo_field = caja.titulo -%}
              {%- assign color_field = caja.color -%}
              <div class="cajas-option-info">
                {%- if imagen_field.value -%}
                  <div class="cajas-option-image">
                    <img src="{{ imagen_field.value | image_url: width: 60 }}" alt="{{ titulo_field.value }}" loading="lazy" width="60" height="60">
                  </div>
                {%- elsif color_field.value -%}
                  <div class="cajas-option-color" style="background-color: {{ color_field.value }};"></div>
                {%- endif -%}
                <div class="cajas-title-container">
                  <span class="cajas-option-title">{{ titulo_field.value }}</span>
                  <span class="cajas-expand-hint">Pulsa para ampliar</span>
                </div>
              </div>
            </label>
          </div>
        {%- endfor -%}
      </div>
    </cajas-selector>
  </div>
{%- else -%}
  <div class="cajas-selector-error">
    <p>No se encontraron cajas configuradas. Por favor, configura el metaobject 'listado_cajas' en el admin.</p>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Custom Boxes Selector",
  "tag": "div",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título del selector",
      "default": "Selecciona tu caja personalizada"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Descripción",
      "default": "Personaliza tu caja seleccionando los productos que deseas incluir."
    },
    {
      "type": "header",
      "content": "Configuración de cajas"
    },
    {
      "type": "number",
      "id": "max_products",
      "label": "Máximo de productos por caja",
      "default": 6
    },
    {
      "type": "number",
      "id": "min_products",
      "label": "Mínimo de productos por caja",
      "default": 3
    },
    {
      "type": "checkbox",
      "id": "show_product_images",
      "label": "Mostrar imágenes de productos",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_prices",
      "label": "Mostrar precios de productos",
      "default": true
    },
    {
      "type": "header",
      "content": "Estilo"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Estilo de diseño",
      "options": [
        {
          "value": "grid",
          "label": "Cuadrícula"
        },
        {
          "value": "list",
          "label": "Lista"
        }
      ],
      "default": "grid"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Espaciado superior",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Espaciado inferior",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 20
    }
  ]
}
{% endschema %}