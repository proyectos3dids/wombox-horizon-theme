{% comment %}
  Bloque personalizado para selector de cajas
  Implementación completa del sistema de cajas con metaobjects
{% endcomment %}

{%- assign listado_cajas = shop.metaobjects.listado_cajas['listado-cajas'].lista -%}
{%- assign cajas = listado_cajas.value -%}

{%- if cajas -%}
  {{ 'cajas-styles.css' | asset_url | stylesheet_tag }}
  <script src="{{ 'cajas-selector.js' | asset_url }}" defer></script>
  
  <div class="product-form__block product-form__cajas" {{ block.shopify_attributes }} data-selected-box-text="{{ block.settings.selected_box_text | default: 'Selected Box' }}" style="--cajas-accent-color: {{ block.settings.accent_color | default: '#d4a697' }}; {% render 'spacing-style', settings: block.settings %}">
    <cajas-selector class="cajas-selector">
      {%- if block.settings.title == "Select your box" or block.settings.title == blank -%}
        <h4 class="cajas-title">{{ 'custom_boxes.title' | t }}</h4>
      {%- else -%}
        <h4 class="cajas-title">{{ block.settings.title }}</h4>
      {%- endif -%}
      {%- if block.settings.description == "Choose the type of box you prefer for your order" -%}
        <p class="cajas-description">{{ 'custom_boxes.description' | t }}</p>
      {%- elsif block.settings.description != blank -%}
        <p class="cajas-description">{{ block.settings.description }}</p>
      {%- else -%}
        <p class="cajas-description">{{ 'custom_boxes.description' | t }}</p>
      {%- endif -%}
      <div class="cajas-options">
        {%- for caja in cajas -%}
          <div class="cajas-option" data-caja-handle="{{ caja.system.handle }}">
            <input type="radio" name="caja-selection" id="caja-{{ caja.system.handle }}" value="{{ caja.system.handle }}" class="cajas-option-input">
            <label for="caja-{{ caja.system.handle }}" class="cajas-option-label">
              {%- assign imagen_field = caja.imagen -%}
              {%- assign titulo_field = caja.titulo -%}
              {%- assign color_field = caja.color -%}
              {%- if imagen_field.value -%}
                <div class="cajas-option-image">
                  <img src="{{ imagen_field.value | image_url: width: 800 }}" alt="{{ titulo_field.value }}" loading="lazy" width="200" height="200">
                  <div class="cajas-magnifier-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                      <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </div>
                </div>
              {%- elsif color_field.value -%}
                <div class="cajas-option-color-full" style="background-color: {{ color_field.value }};"></div>
              {%- endif -%}
            </label>
          </div>
        {%- endfor -%}
      </div>
    </cajas-selector>
  </div>
{%- else -%}
  <div class="cajas-selector-error">
    <p>No se encontraron cajas configuradas. Por favor, configura el metaobject 'listado_cajas' en el admin.</p>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Custom Boxes Selector",
  "tag": "div",
  "class": "product-form__block",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título del selector",
      "default": "Select your box",
      "info": "Deja vacío para usar la traducción automática"
    },
    {"type": "textarea",
      "id": "description",
      "label": "Descripción",
      "default": "Choose the type of box you prefer for your order",
      "info": "El texto se traducirá automáticamente según el idioma de la tienda"
    },
    {
      "type": "header",
      "content": "Textos personalizables"
    },
    {
      "type": "text",
      "id": "expand_hint_text",
      "label": "Texto de expansión",
      "default": "Click to expand"
    },
    {
      "type": "text",
      "id": "selected_box_text",
      "label": "Texto de caja seleccionada",
      "default": "Selected Box"
    },
    {
       "type": "header",
       "content": "Configuración de cajas"
     },
     {
      "type": "number",
      "id": "max_products",
      "label": "Máximo de productos por caja",
      "default": 6
    },
    {
      "type": "number",
      "id": "min_products",
      "label": "Mínimo de productos por caja",
      "default": 3
    },
    {
      "type": "checkbox",
      "id": "show_product_images",
      "label": "Mostrar imágenes de productos",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_prices",
      "label": "Mostrar precios de productos",
      "default": true
    },
    {
      "type": "header",
      "content": "Estilo"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Estilo de diseño",
      "options": [
        {
          "value": "grid",
          "label": "Cuadrícula"
        },
        {
          "value": "list",
          "label": "Lista"
        }
      ],
      "default": "grid"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Color de acento",
      "default": "#d4a697",
      "info": "Color utilizado para el título, bordes de selección y iconos"
    },
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Espaciado superior",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Espaciado inferior",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "Espaciado izquierdo",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "Espaciado derecho",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Custom Boxes Selector",
      "category": "product"
    }
  ]
}
{% endschema %}